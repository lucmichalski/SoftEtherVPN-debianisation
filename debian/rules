#!/usr/bin/make -f

define generate_stub
	mkdir -p debian/usr/bin
	echo '#!/bin/sh'                              > debian/usr/bin/$(1)
	echo '/usr/libexec/softether/$(1)/$(1) "$$@"' >> debian/usr/bin/$(1)
	echo 'exit $?'                               >> debian/usr/bin/$(1)
	chmod +x debian/usr/bin/$(1)
endef

export DH_VERBOSE=1
export export CMAKE_INSTALL_PREFIX=../debian/usr
export CMAKE_VERSION=3.12.3

%:
	dh $@

override_dh_auto_configure:
	wget https://cmake.org/files/v${CMAKE_VERSION%.*}/cmake-${CMAKE_VERSION}.tar.gz && tar -xzf cmake-${CMAKE_VERSION}.tar.gz
	cd cmake-${CMAKE_VERSION} && ./bootstrap && make install && cd -
	cmake .

override_dh_auto_install:
	dh_auto_install
	$(call generate_stub,vpnserver)
	$(call generate_stub,vpnbridge)
	$(call generate_stub,vpncmd)
	$(call generate_stub,vpnclient)
